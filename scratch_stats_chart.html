<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Scratch çµ±è¨ˆã‚°ãƒ©ãƒ•ãƒ„ãƒ¼ãƒ«</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 40px;
  }
  input, button {
    font-size: 16px;
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin: 5px;
  }
  button {
    background: #4f46e5;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #3730a3;
  }
  #chart-container {
    width: 90%;
    max-width: 900px;
    margin: 40px auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

  <h1>ğŸ¨ Scratch ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆã‚°ãƒ©ãƒ•</h1>
  <input id="user" placeholder="Scratchãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›">
  <button onclick="loadStats()">è¡¨ç¤º</button>

  <div id="summary"></div>
  <div id="chart-container">
    <canvas id="chart"></canvas>
  </div>

<script>
async function loadStats() {
  const username = document.getElementById("user").value.trim();
  if (!username) return alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
  
  const res = await fetch(`https://api.scratch.mit.edu/users/${username}/projects`);
  const projects = await res.json();

  if (!Array.isArray(projects) || projects.length === 0) {
    document.getElementById("summary").innerHTML = `<p>ä½œå“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>`;
    return;
  }

  let totalLikes = 0, totalViews = 0;
  const titles = [], likes = [], views = [];

  projects.forEach(p => {
    titles.push(p.title);
    likes.push(p.stats.loves);
    views.push(p.stats.views);
    totalLikes += p.stats.loves;
    totalViews += p.stats.views;
  });

  document.getElementById("summary").innerHTML = `
    <h2>${username} ã•ã‚“ã®çµ±è¨ˆ</h2>
    <p>ä½œå“æ•°: ${projects.length}</p>
    <p>åˆè¨ˆã„ã„ã­æ•°: ${totalLikes}</p>
    <p>åˆè¨ˆé–²è¦§æ•°: ${totalViews}</p>
  `;

  // ã‚°ãƒ©ãƒ•æç”»
  const ctx = document.getElementById('chart');
  if (window.chart) window.chart.destroy(); // æ—¢å­˜ã‚°ãƒ©ãƒ•ã‚’å‰Šé™¤
  window.chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: titles,
      datasets: [
        {
          label: 'ã„ã„ã­æ•°',
          data: likes,
          backgroundColor: 'rgba(75, 192, 192, 0.7)'
        },
        {
          label: 'é–²è¦§æ•°',
          data: views,
          backgroundColor: 'rgba(255, 159, 64, 0.7)'
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: `${username} ã•ã‚“ã®ä½œå“ãƒ‡ãƒ¼ã‚¿` }
      },
      scales: {
        x: { ticks: { maxRotation: 90, minRotation: 45 } },
        y: { beginAtZero: true }
      }
    }
  });
}
</script>

</body>
</html>
